<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>DOE Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
        }
        .input-table {
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
        }
        td, th {
            border: 1px solid #ccc;
            padding: 5px 10px;
            text-align: center;
        }
        .plots {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .plot-container {
            width: 300px;
        }
        #equation-result {
            margin-top: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>Design of Experiments - Input</h2>
    <div class="input-table">
        <table>
            <thead>
                <tr><th>X1</th><th>X2</th><th>Y</th></tr>
            </thead>
            <tbody id="input-rows"></tbody>
        </table>
        <div id="equation-result"></div>
        <button onclick="calculate()" style="margin-top:8px;">Calculate</button>
    </div>

    <div class="plots">
        <div class="plot-container">
            <canvas id="paretoChart"></canvas>
        </div>
        <div class="plot-container">
            <canvas id="mainEffectX1"></canvas>
        </div>
        <div class="plot-container">
            <canvas id="mainEffectX2"></canvas>
        </div>
        <div class="plot-container">
            <canvas id="interactionPlot"></canvas>
        </div>
    </div>

    <script>
        // Default input values as requested: 1,2,3,8 for Y
        const X1 = [-1, -1, 1, 1];
        const X2 = [-1, 1, -1, 1];
        const defaultY = [1, 2, 3, 8];

        window.onload = () => {
            const tbody = document.getElementById('input-rows');
            for (let i = 0; i < 4; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${X1[i]}</td>
                    <td>${X2[i]}</td>
                    <td><input type="number" value="${defaultY[i]}" id="Y${i}" style="width:60px"></td>
                `;
                tbody.appendChild(row);
            }
            calculate(); // Calculate initially on load to show plots & equation
        };

        function calculate() {
            const Y = [0, 0, 0, 0].map((_, i) => parseFloat(document.getElementById('Y' + i).value));
            const coefficients = getCoefficients(Y);
            // Format equation with signs and 2 decimals
            const terms = [
                coefficients[0].toFixed(2),
                (coefficients[1] >= 0 ? "+ " : "- ") + Math.abs(coefficients[1]).toFixed(2) + "*X1",
                (coefficients[2] >= 0 ? "+ " : "- ") + Math.abs(coefficients[2]).toFixed(2) + "*X2",
                (coefficients[3] >= 0 ? "+ " : "- ") + Math.abs(coefficients[3]).toFixed(2) + "*X1*X2"
            ];
            document.getElementById("equation-result").textContent = "Y = " + terms.join(" ");
            plotPareto(coefficients);
            plotMainEffectX1(coefficients);
            plotMainEffectX2(coefficients);
            plotInteraction(coefficients);
        }

        function getCoefficients(Y) {
            const X = X1.map((x1, i) => [1, x1, X2[i], x1 * X2[i]]);
            const XT = math.transpose(X);
            const XTX = math.multiply(XT, X);
            const XTY = math.multiply(XT, Y);
            return math.lusolve(XTX, XTY).flat();
        }

        function calculateY(coeffs, x1, x2) {
            return coeffs[0] + coeffs[1] * x1 + coeffs[2] * x2 + coeffs[3] * x1 * x2;
        }

        function plotPareto(coeffs) {
            new Chart("paretoChart", {
                type: "bar",
                data: {
                    labels: ["X1", "X2", "X1*X2"],
                    datasets: [{
                        label: "Effect",
                        data: coeffs.slice(1).map(Math.abs),
                        backgroundColor: "gray"  // Gray bars
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { title: { display: true, text: 'Pareto Chart' } }
                }
            });
        }

        function plotMainEffectX1(coeffs) {
            const x = [-1, 1];
            const y1 = x.map(x1 => calculateY(coeffs, x1, 0));
            new Chart("mainEffectX1", {
                type: "line",
                data: { labels: x, datasets: [{ label: "Y vs X1", data: y1, borderColor: "black", fill: false }] },
                options: { plugins: { title: { display: true, text: "Main Effect: X1" } } }
            });
        }

        function plotMainEffectX2(coeffs) {
            const x = [-1, 1];
            const y2 = x.map(x2 => calculateY(coeffs, 0, x2));
            new Chart("mainEffectX2", {
                type: "line",
                data: { labels: x, datasets: [{ label: "Y vs X2", data: y2, borderColor: "black", fill: false }] },
                options: { plugins: { title: { display: true, text: "Main Effect: X2" } } }
            });
        }

        function plotInteraction(coeffs) {
            const x = [-1, 1];
            const yLow = x.map(x1 => calculateY(coeffs, x1, -1));
            const yHigh = x.map(x1 => calculateY(coeffs, x1, 1));
            new Chart("interactionPlot", {
                type: "line",
                data: {
                    labels: x,
                    datasets: [
                        { label: "X2 = -1", data: yLow, borderColor: "black", fill: false },
                        { label: "X2 = +1", data: yHigh, borderColor: "gray", fill: false }
                    ]
                },
                options: { plugins: { title: { display: true, text: "Interaction Plot" } } }
            });
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
</body>
</html>
